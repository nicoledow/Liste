<% if @list %>
  <h1> <%= @list.title %>
<% else %>
  <h1> Current tasks: </h1>
<% end %>


<%= form_for @task do |f| %>
  <%= f.text_field :description %> <br>
  
  <% if @list %>
    <%= f.hidden_field :list_id, value: @list.id%>
  <% else %>
    <%= f.label :list_id %>
    <%= f.collection_select(:list_id, @lists, :id, :title) %> <br>
  <% end %>

  <%= f.submit "Add Task" %>
<% end %>

<ul>
  <% @tasks.each do |task| %>
    <li>
      <%= link_to task.description, task_path(task) %>

<!-- if the current user is assigned this task, or if they are a manager, they can mark it complete -->
  <% if @current_user %>
    <% if @current_user.manager? || @task.is_assigned_to?(@current_user) %>
      <button> <%= link_to 'Finished', task_complete_path(@task), method: :post %> </button>
    <% end %>
  <% end %>

<!-- if user is a manager, they can assign the task to another user: -->
      <% if current_user.manager? %>
        <% if !task.assigned? %>
          <%= form_for @assignment do |f| %>
            <%= f.collection_select(:user_id, @users, :id, :name)%>
            <%= f.text_field :due_date, value: "Due date"%>
            <%= f.hidden_field :task_id, value: task.id %>
            <%= f.submit "Assign Task" %>
          <% end %>
        <% end %>
<!-- if current user is manager, they can delete the task -->
          <button> <%= link_to "Delete Task", task_path(task), :method => :delete %> </button>
      <% end %>
      
    </li>
  <% end %>
</ul>